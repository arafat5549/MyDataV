{"version":3,"sources":["webpack:///js/bundle.js","webpack:///webpack/bootstrap 306e9e7ab608d0c5b2a1","webpack:///./app/app.js","webpack:///./app/main.js"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","i","l","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","initPowerIcon","url","type","$","ajax","success","results","features","length","geometry","coordinates","gcj02towgs84","ol","format","GeoJSON","readFeatures","featureProjection","powerSource","source","Vector","powerIconLayer","setSource","monitorIconLayer","siteIconLayer","getChartData","plusData","fid","val","beginDate","endDate","console","log","xhost_getEchartDataOption3","async","data","dataType","jsondata","node","document","getElementById","title","text","subtext","echarts","init","setOption","buildPopUp","map","coordinate","popup_element","content","closer","titleinfo","plusinfo","plusinfo_suf","offset","className","info_popup","Overlay","element","autoPan","autoPanAnimation","duration","addOverlay","innerHTML","setPosition","on","event","preventDefault","undefined","show","this","hasClass","hide","toggleClass","xhost","layer","style","feature","resolution","getGeometry","getCoordinates","cityIcon","Style","image","Icon","opacity","scale","src","geom","Point","setStyle","label_element","createElement","stopEvent","evt","remove","pixel","getEventPixel","originalEvent","forEachFeatureAtPixel","href","append","gpsType","videoObject","container","variable","flashplayer","video","autoplay","ckplayer","id","deviceinfoName","monitorsiteName","longitude","latitude","plusWidth","userName","siteid","html","code","click","parents","addClass","dragging","push","ii","showname","shownamePopelement","shownamePop","addLayer","setZIndex","vector1","projection","KML","defaultStyle","stroke","Stroke","width","attr","removeLayer"],"mappings":"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","file":"js/bundle.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\n// var mapfunction = require('./mapfunction.js');\n// var maprequest = require('./maprequest');\n// var loadOverlay = require('./loadOverlay.js');\n// var eventbind = require('./eventbind.js');\n// var eventbind = require('./datepicker.js');\n\nvar main = __webpack_require__(1);\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\n//访问获取JSON数据\nvar xhost = \"http://127.0.0.1:8088/\";\n\nvar xhost_getFactors = xhost + \"api/getFactors\";\nvar xhost_getEchartDataOption3 = xhost + \"api/getEchartDataOption3\";\nvar xhost_getDevices = xhost + \"api/gps/getDevices?type=1\";\nvar xhost_getMonitors = xhost + \"api/gps/getDevices?type=2\";\nvar xhost_getSites = xhost + \"api/gps/getSites\";\n//###############################################################//\n//                  图片层                                        //\n//###############################################################//\nvar powerIconLayer = new ol.layer.Vector({\n  style: function style(feature, resolution) {\n    var route = feature.getGeometry();\n    var coordinate = feature.getGeometry().getCoordinates();\n    var cityIcon = \"../images/sdz.png\";\n\n    if (feature.get('equipName')) {\n      cityIcon = \"../images/industry.png\";\n    }\n\n    var style = new ol.style.Style({\n      image: new ol.style.Icon({\n        opacity: 1,\n        scale: 1,\n        src: cityIcon\n      }),\n      geometry: new ol.geom.Point(coordinate)\n    });\n    feature.setStyle(style);\n\n    var label_element = document.createElement('div');\n    label_element.className = 'label cityLabel';\n    label_element.innerHTML = '<span class=\"donenum\">' + feature.get('deviceinfoName') + '</span>';\n    var label = new ol.Overlay({\n      element: label_element,\n      offset: [-3, -42],\n      stopEvent: false\n    });\n    label.setPosition(coordinate);\n    //map.addOverlay(label);\n  }\n});\n//监控探头\nvar monitorIconLayer = new ol.layer.Vector({\n  style: function style(feature, resolution) {\n    var route = feature.getGeometry();\n    var coordinate = feature.getGeometry().getCoordinates();\n    var cityIcon = \"../images/monitor.png\";\n    var style = new ol.style.Style({\n      image: new ol.style.Icon({\n        opacity: 1,\n        scale: 1,\n        src: cityIcon\n      }),\n      geometry: new ol.geom.Point(coordinate)\n    });\n    feature.setStyle(style);\n  }\n});\n//监测站点\nvar siteIconLayer = new ol.layer.Vector({\n  style: function style(feature, resolution) {\n    var route = feature.getGeometry();\n    var coordinate = feature.getGeometry().getCoordinates();\n    var cityIcon = \"../images/company.png\";\n    if (feature.get(\"parentId\") == 0) {\n      cityIcon = \"../images/ent.png\";\n    }\n    var style = new ol.style.Style({\n      image: new ol.style.Icon({\n        opacity: 1,\n        scale: 1,\n        src: cityIcon\n      }),\n      geometry: new ol.geom.Point(coordinate)\n    });\n    feature.setStyle(style);\n  }\n});\n\n//###############################################################//\n//                  初始化图片层                                 //\n//###############################################################//\nfunction initPowerIcon(url, type) {\n  // if(type !=1 && type!=2 && type !=99) return;\n  $.ajax({\n    url: url,\n    success: function success(results) {\n      if (results.features) {\n        for (var i = 0; i < results.features.length; i++) {\n          results.features[i].geometry.coordinates = gcj02towgs84(results.features[i].geometry.coordinates[0], results.features[i].geometry.coordinates[1]);\n        }\n        var features = new ol.format.GeoJSON().readFeatures(results, {\n          featureProjection: 'EPSG:3857'\n        });\n        var powerSource = new ol.source.Vector({\n          features: features\n        });\n        var routeCoords = features;\n\n        if (type == 1) {\n          powerIconLayer.setSource(powerSource);\n        } else if (type == 2) {\n          monitorIconLayer.setSource(powerSource);\n        } else if (type == 3) {\n          siteIconLayer.setSource(powerSource);\n        }\n      }\n    }\n  });\n}\n\n//显示marker的内容\nvar displayFeatureInfo = function displayFeatureInfo(pixel) {\n  var features = [];\n  map.forEachFeatureAtPixel(pixel, function (feature) {\n    features.push(feature);\n  });\n  // var lonlat = map.getLonLatFromPixel(pixel);\n  if (features.length > 0) {\n    var info = [];\n    var i, ii;\n    for (i = 0, ii = features.length; i < ii; ++i) {\n      info.push(features[i].get('name'));\n    }\n    // document.getElementById('info').innerHTML = info.join(', ') || '(unknown)';\n\n    var shownamePop = '<div class=\"namepop\"></div>';\n    $('.namepop').html('<a href=\"javascript\">' + features[i].get('name') + '</a>');\n    var shownamePop = new ol.Overlay({\n      element: shownamePop,\n      autoPan: true,\n      offset: [-4, -4],\n      autoPanAnimation: {\n        duration: 250 //当Popup超出地图边界时，地图移动的速度\n      }\n    });\n    shownamePop.setPosition(evt.coordinate);\n  } else {\n    // document.getElementById('info').innerHTML = '&nbsp;';\n  }\n};\n//###############################################################//\n//                  事件区域                                     //\n//###############################################################//\n//为map添加点击事件监听，弹出popup\nvar map_click = map.on('click', function (evt) {\n  //endCall(false);\n  $('.ol-overlaycontainer-stopevent .ol-popup-container').remove();\n  $('.commonlog-box').remove();\n  var pixel = map.getEventPixel(evt.originalEvent);\n  var feature = map.forEachFeatureAtPixel(pixel, function (feature) {\n    return feature;\n  }); //判断当前单击处是否有要素，捕获到要素时弹出popup\n  // console.log(feature.getKeys())\n\n  var coordinate = evt.coordinate;\n  console.log(feature, feature.get(\"gpsType\"));\n  if (feature !== undefined) {\n    var popup_element = document.createElement('div');\n    popup_element.className = 'ol-popup';\n    var closer = document.createElement('a');\n    closer.href = 'javascript:;';\n    closer.className = 'ol-popup-closer';\n    var title = document.createElement('div');\n    title.className = 'title';\n    var content = document.createElement('div');\n    content.className = 'popup-content';\n    $(popup_element).append(closer);\n    $(popup_element).append(title);\n    $(popup_element).append(content);\n    //var coordinates = feature.getGeometry().get(\"coordinates\");\n    //-----------------------------------------------------\n    var gpsType = feature.get(\"gpsType\");\n    if (gpsType == 2 && feature.get('url') != \"\" && feature.get('url') != undefined) {\n      //视频监控\n      popup_element.className = 'ol-popup ol-popup-monitor';\n      var info_popup = new ol.Overlay({\n        element: popup_element,\n        autoPan: true,\n        offset: [-220, -445],\n        autoPanAnimation: {\n          duration: 250 //当Popup超出地图边界时，地图移动的速度\n        }\n      });\n      map.addOverlay(info_popup);\n      title.innerHTML = '<div><strong>视频详情</strong></div></div>';\n      content.innerHTML = '<div class=\"down-arrow2\"></div><div class=\"cesium-infoBox-description\"><div id=\"myplayer\" style=\"width:480px; height:340px\"></div></div>';\n      info_popup.setPosition(coordinate);\n\n      var videoObject = {\n        container: '#myplayer', //“#”代表容器的ID，“.”或“”代表容器的class\n        variable: 'player', //该属性必需设置，值等于下面的new chplayer()的对象\n        flashplayer: false, //如果强制使用flashplayer则设置成true\n        video: feature.get('url'), //视频地址\n        autoplay: true\n      };\n      var player = new ckplayer(videoObject);\n\n      $(closer).on('click', function (event) {\n        event.preventDefault();\n        info_popup.setPosition(undefined);\n      }); // 点击关闭的按钮\n    } else if (gpsType == 1 && feature.get('id') != undefined) {\n      //  popup_element.className = 'ol-popup ol-popup-station ol-popup-industry';\n      //   var info_popup = new ol.Overlay(({\n      //   element: popup_element,\n      //   autoPan: true,\n      //   offset:[-180,-152],\n      //   autoPanAnimation: {\n      //     duration: 250 //当Popup超出地图边界时，地图移动的速度\n      //   }\n      // }));\n      // map.addOverlay(info_popup);\n      // var name = feature.get(\"id\");\n      // var deviceinfoName = feature.get(\"deviceinfoName\");\n      // var monitorsiteName = feature.get(\"monitorsiteName\");\n\n      // title.innerHTML = '<div><strong>监测站点</strong></div></div>';\n      // content.innerHTML ='<div class=\"icon-drop2\"></div><div class=\"down-arrow2\"></div><div class=\"cesium-infoBox-description\"><table>'+\n      // '<tr><th width=150>检测器ID</th><td>'+name+\n      // '<tr><th width=150>检测器名称</th><td>'+deviceinfoName+\n      // '<tr><th width=150>所属监测站</th><td>'+monitorsiteName+\n      // '<tr><th width=150>经度</th><td>'+feature.get(\"longitude\")+\n      // '<tr><th width=150>纬度</th><td>'+feature.get(\"latitude\")+\n      // '</table></div>';\n      // info_popup.setPosition(coordinate);\n      // $(closer).on('click', function(event) {\n      //   event.preventDefault();\n      //   info_popup.setPosition(undefined);\n      // }); // 点击关闭的按钮\n      // $('.ol-popup-industry .icon-drop2').on('click',  function(){\n      //     $('.ol-popup-industry table tr').show();\n      //     if($(this).hasClass('icon-sq')) {\n      //       $('.ol-popup-industry table tr:gt(8)').hide()\n      //     }\n      //     $(this).toggleClass('icon-sq');\n      //     $('.down-arrow2').toggleClass('hide')\n      // })\n\n      var id = feature.get(\"id\");\n      var deviceinfoName = feature.get(\"deviceinfoName\");\n      var monitorsiteName = feature.get(\"monitorsiteName\");\n      var longitude = feature.get(\"longitude\");\n      var latitude = feature.get(\"latitude\");\n      var plusinfo = '';\n      plusinfo += '<tr><th width=150>检测器ID</th><td>' + id;\n      plusinfo += '<tr><th width=150>检测器名称</th><td>' + deviceinfoName;\n      plusinfo += '<tr><th width=150>所属监测站</th><td>' + monitorsiteName;\n      plusinfo += '<tr><th width=150>经度</th><td>' + longitude;\n      plusinfo += '<tr><th width=150>纬度</th><td>' + latitude;\n      plusinfo += '<tr><th width=150>下位机IP</th><td>' + feature.get(\"ipAddress\");\n      plusinfo += '<tr><th width=150>端口</th><td>' + feature.get(\"port\");\n      plusinfo += '<tr><th width=150>状态</th><td>' + feature.get(\"status\");\n      plusWidth = -63 * 8;\n      var plusinfo_suf = \"\";\n      buildPopUp(map, coordinate, popup_element, title, content, closer, '监测设备信息', plusinfo, plusinfo_suf, [-180, plusWidth]);\n    } else if (gpsType == 99) {\n      var plusinfo = \"\";\n      var plusWidth = 0;\n      var name = feature.get(\"name\");\n      var userName = feature.get(\"userName\");\n      var longitude = feature.get(\"longitude\");\n      var latitude = feature.get(\"latitude\");\n      var siteid = feature.get(\"id\");\n      plusinfo += '<tr><th width=150>监测站点名称</th><td>' + name + \"</td></tr>\";\n      plusinfo += '<tr><th width=150>负责人</th><td>' + userName + \"</td></tr>\";\n      plusinfo += '<tr><th width=150>经度</th><td>' + longitude + \"</td></tr>\";\n      plusinfo += '<tr><th width=150>纬度</th><td>' + latitude + \"</td></tr>\";\n      //plusinfo+='<tr><th width=75>指标</th><td>'+latitude;\n\n      plusWidth = -63 * 4;\n\n      var plusinfo_suf = \"\";\n      plusinfo_suf += '<span>指标</span>';\n      plusinfo_suf += '<select id=\"sel_factor\">';\n      //plusinfo_suf+='<option>Volvo</option>'\n      //plusinfo_suf+='<option selected=\"selected\">Saab</option>'\n      //plusinfo_suf+='<option>Mercedes</option>'\n      //plusinfo_suf+='<option>Audi</option>'\n      plusinfo_suf += '</select>';\n      plusinfo_suf += '   <button id=\"search\">&nbsp;查询&nbsp;</button>';\n      plusinfo_suf += '<br>';\n      //plusinfo_suf+='<span>起始</span><input name=\"start_time\" type=\"text\"    class=\"Wdate\" id=\"date1\" onfocus=\"WdatePicker({dateFmt: \\'yyyy/MM\\'})\">'\n      plusinfo_suf += '<span>起始</span><input name=\"start_time\" type=\"text\" class=\"Wdate\" id=\"beginDate\" onfocus=\"WdatePicker({dateFmt: \\'yyyy-MM\\',maxDate:\\'#F{$dp.$D(\\\\\\'endDate\\\\\\')||\\\\\\'%y-%M-%d\\\\\\'}\\' })\">';\n      plusinfo_suf += '<span>结束</span><input name=\"start_time\" type=\"text\" class=\"Wdate\" id=\"endDate\" onfocus=\"WdatePicker({dateFmt: \\'yyyy-MM\\',maxDate:\\'%y-%M-%d\\', minDate:\\'#F{$dp.$D(\\\\\\'beginDate\\\\\\')}\\' })\">';\n      plusinfo_suf += '<div id=\"chartDiv\" style=\"width: 400px;height:400px;\"></div>';\n      plusWidth = -63 * 5;\n      buildPopUp(map, coordinate, popup_element, title, content, closer, '监测站点', plusinfo, plusinfo_suf, [-180, plusWidth]);\n\n      $.get(xhost_getFactors, function (data) {\n        console.log(data);\n        $(\"#sel_factor\").html(\"\");\n        for (var i = data.length - 1; i >= 0; i--) {\n          $(\"#sel_factor\").append(\"<option value='\" + data[i].code + \"' >\" + data[i].name + \"</option>\");\n        }\n      });\n      //getChartData()\n      $(\"#search\").click(function () {\n        getChartData(\"&monitorSiteId=\" + siteid);\n      });\n    }\n    $('.ol-popup').parents('.ol-overlay-container').addClass('ol-popup-container');\n  }\n});\n\nfunction getChartData(plusData) {\n  var fid = $(\"#sel_factor option:selected\").val();\n  var beginDate = $(\"#beginDate\").val();\n  var endDate = $(\"#endDate\").val();\n  console.log(fid, beginDate, endDate);\n  $.ajax({\n    url: xhost_getEchartDataOption3,\n    async: false,\n    data: \"type=line&dateType=month&factor=\" + fid + \"&beginDate=\" + beginDate + \"&endDate=\" + endDate + plusData,\n    dataType: \"json\",\n    success: function success(jsondata) {\n      var chartDivId = \"chartDiv\";\n      var node = document.getElementById(chartDivId);\n      var title = jsondata.title.text;\n      //$(\"#\"+chartDivId+\"_title\").text(title+\" (\"+ jsondata.title.subtext+\")\");\n      //console.log(title);\n      jsondata.title.text = \"\";\n      jsondata.title.subtext = \"\";\n      var myChart = echarts.init(node, 'light');\n      myChart.setOption(jsondata, true);\n    }\n  });\n}\n//\nfunction buildPopUp(map, coordinate, popup_element, title, content, closer, titleinfo, plusinfo, plusinfo_suf, offset) {\n  popup_element.className = 'ol-popup ol-popup-station ol-popup-industry';\n  var info_popup = new ol.Overlay({\n    element: popup_element,\n    autoPan: true,\n    offset: offset,\n    autoPanAnimation: {\n      duration: 250 //当Popup超出地图边界时，地图移动的速度\n    }\n  });\n  map.addOverlay(info_popup);\n  // var name = feature.get(\"id\");\n  // var deviceinfoName = feature.get(\"deviceinfoName\");\n  // var monitorsiteName = feature.get(\"monitorsiteName\");\n  // var longitude   = feature.get(\"longitude\");\n  // var latitude   = feature.get(\"latitude\");\n\n  title.innerHTML = '<div><strong>' + titleinfo + '</strong></div></div>';\n  content.innerHTML = '<div class=\"icon-drop2\"></div><div class=\"down-arrow2\"></div><div class=\"cesium-infoBox-description\"><table>' +\n  // '<tr><th width=150>检测器ID</th><td>'+name+\n  // '<tr><th width=150>检测器名称</th><td>'+deviceinfoName+\n  // '<tr><th width=150>所属监测站</th><td>'+monitorsiteName+\n  // '<tr><th width=150>经度</th><td>'+longitude+\n  // '<tr><th width=150>纬度</th><td>'+latitude+\n  plusinfo + '</table>' + plusinfo_suf + '</div>';\n\n  info_popup.setPosition(coordinate);\n  $(closer).on('click', function (event) {\n    event.preventDefault();\n    info_popup.setPosition(undefined);\n  }); // 点击关闭的按钮\n  $('.ol-popup-industry .icon-drop2').on('click', function () {\n    $('.ol-popup-industry table tr').show();\n    if ($(this).hasClass('icon-sq')) {\n      $('.ol-popup-industry table tr:gt(8)').hide();\n    }\n    $(this).toggleClass('icon-sq');\n    $('.down-arrow2').toggleClass('hide');\n  });\n}\n//\nmap.on('pointermove', function (evt) {\n  $('.ol-overlaycontainer-stopevent .ol-namepop-container').remove();\n  if (evt.dragging) {\n    return;\n  }\n  var pixel = map.getEventPixel(evt.originalEvent);\n  var features = [];\n  map.forEachFeatureAtPixel(pixel, function (feature) {\n    features.push(feature);\n  });\n\n  if (features.length > 0) {\n    var i, ii;\n    for (i = 0, ii = features.length; i < ii; ++i) {\n      var gpsType = features[i].get(\"gpsType\");\n\n      //if(features[i].get('deviceinfoName')!=undefined && features[i].get('monitorsiteName')!= undefined)\n      if (gpsType != undefined) {\n        var showname = features[i].get('deviceinfoName');\n        if (gpsType == 99) {\n          showname = features[i].get('name');\n        }\n        var shownamePopelement = document.createElement('div');\n        shownamePopelement.className = 'ol-namepop';\n        $('.ol-namepop').parents('.ol-overlay-container').addClass('ol-namepop-container');\n\n        $('.ol-namepop').html('<a href=\"javascript:;\">' + showname + '</a>');\n        var shownamePop = new ol.Overlay({\n          element: shownamePopelement,\n          autoPan: true,\n          offset: [14, -4],\n          autoPanAnimation: {\n            duration: 250 //当Popup超出地图边界时，地图移动的速度\n          }\n        });\n        map.addOverlay(shownamePop);\n        shownamePop.setPosition(evt.coordinate);\n      }\n    }\n  }\n});\n//###############################################################//\n//                  初始化区域                                   //\n//###############################################################//\n\n\n// 水电站 -添加marker点\ninitPowerIcon(xhost_getDevices, 1);\nmap.addLayer(powerIconLayer);\npowerIconLayer.setZIndex(7);\n\n//监控探头\ninitPowerIcon(xhost_getMonitors, 2);\nmap.addLayer(monitorIconLayer);\nmonitorIconLayer.setZIndex(7);\n\ninitPowerIcon(xhost_getSites, 3);\nmap.addLayer(siteIconLayer);\nsiteIconLayer.setZIndex(7);\n// 三明区域线\nvar vector1 = new ol.layer.Vector({\n  source: new ol.source.Vector({\n    url: '../resource/mapData/sanming1.kml',\n    // projection: prj.gps84_To_Gcj02('EPSG:4326', 'EPSG:3857'),\n    projection: 'EPSG:3857',\n    format: new ol.format.KML({\n      // extractStyles: false,\n      // writeStyles:true,\n      defaultStyle: new ol.style.Style({\n        stroke: new ol.style.Stroke({\n          // color: 'rgba(251, 177, 0, 1)',\n          width: 2\n        })\n      })\n    })\n  })\n});\nmap.addLayer(vector1);\nvector1.setZIndex(6);\n\n//###############################################################//\n//                 页面事件(jquery)区域                          //\n//###############################################################//\n$('.js-togglewater').click(function () {\n  if ($(this).hasClass('active')) {\n    map.addLayer(powerIconLayer);\n    $(this).attr('title', '点击隐藏水质监测仪器');\n  } else {\n    map.removeLayer(powerIconLayer);\n    $(this).attr('title', '点击显示水质监测仪器');\n  }\n  $(this).toggleClass('active');\n});\n$('.js-togglestation').click(function () {\n  if ($(this).hasClass('active')) {\n    //$('.ol-overlaycontainer-stopevent .people-label').show()\n    map.addLayer(monitorIconLayer);\n    $(this).attr('title', '点击隐藏视频监控');\n  } else {\n    //$('.ol-overlaycontainer-stopevent .people-label').hide()\n    map.removeLayer(monitorIconLayer);\n    $(this).attr('title', '点击显示视频监控');\n  }\n  $(this).toggleClass('active');\n});\n\n/***/ })\n/******/ ]);\n\n\n// WEBPACK FOOTER //\n// js/bundle.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 306e9e7ab608d0c5b2a1","// var mapfunction = require('./mapfunction.js');\n// var maprequest = require('./maprequest');\n// var loadOverlay = require('./loadOverlay.js');\n// var eventbind = require('./eventbind.js');\n// var eventbind = require('./datepicker.js');\n\nvar main = require('./main.js');\n\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./app/app.js","//访问获取JSON数据\nvar xhost = \"http://127.0.0.1:8088/\";\n\nvar xhost_getFactors  = xhost+\"api/getFactors\";\nvar xhost_getEchartDataOption3 = xhost+\"api/getEchartDataOption3\";\nvar xhost_getDevices  = xhost+\"api/gps/getDevices?type=1\";\nvar xhost_getMonitors = xhost+\"api/gps/getDevices?type=2\";\nvar xhost_getSites    = xhost+\"api/gps/getSites\"\n//###############################################################//\n//                  图片层                                        //\n//###############################################################//\nvar powerIconLayer = new ol.layer.Vector({\n  style: function(feature, resolution) {\n    var route =  feature.getGeometry();\n    var coordinate = feature.getGeometry().getCoordinates();\n    var cityIcon =\"../images/sdz.png\"\n\n    if(feature.get('equipName')){\n      cityIcon =\"../images/industry.png\"\n    }\n\n    var style = new ol.style.Style({\n      image: new ol.style.Icon({\n        opacity: 1,\n        scale: 1,\n        src: cityIcon,\n      }),\n      geometry: new ol.geom.Point(coordinate),\n    });\n    feature.setStyle(style);\n\n    var label_element = document.createElement('div');\n    label_element.className = 'label cityLabel';\n    label_element.innerHTML = '<span class=\"donenum\">'+feature.get('deviceinfoName')+'</span>';\n    var label = new ol.Overlay({\n      element: label_element,\n      offset: [-3, -42],\n      stopEvent: false\n    });\n    label.setPosition(coordinate);\n    //map.addOverlay(label);\n  }\n});\n//监控探头\nvar monitorIconLayer = new ol.layer.Vector({\n  style: function(feature, resolution) {\n    var route =  feature.getGeometry();\n    var coordinate = feature.getGeometry().getCoordinates();\n    var cityIcon =\"../images/monitor.png\"\n    var style = new ol.style.Style({\n      image: new ol.style.Icon({\n        opacity: 1,\n        scale: 1,\n        src: cityIcon,\n      }),\n      geometry: new ol.geom.Point(coordinate),\n    });\n    feature.setStyle(style);\n  }\n});\n//监测站点\nvar siteIconLayer = new ol.layer.Vector({\n   style: function(feature, resolution) {\n    var route =  feature.getGeometry();\n    var coordinate = feature.getGeometry().getCoordinates();\n    var cityIcon =\"../images/company.png\"\n    if(feature.get(\"parentId\")==0){\n      cityIcon =\"../images/ent.png\"\n    }\n    var style = new ol.style.Style({\n      image: new ol.style.Icon({\n        opacity: 1,\n        scale: 1,\n        src: cityIcon,\n      }),\n      geometry: new ol.geom.Point(coordinate),\n    });\n    feature.setStyle(style);\n  }\n});\n\n//###############################################################//\n//                  初始化图片层                                 //\n//###############################################################//\nfunction initPowerIcon(url,type) {\n // if(type !=1 && type!=2 && type !=99) return;\n  $.ajax({\n    url:url,\n    success: function(results) {\n      if(results.features) {\n        for(var i = 0; i<results.features.length; i++){\n              results.features[i].geometry.coordinates = gcj02towgs84(results.features[i].geometry.coordinates[0],results.features[i].geometry.coordinates[1]);\n            }\n        var features = (new ol.format.GeoJSON()).readFeatures(results,{\n            featureProjection: 'EPSG:3857'\n        });\n        var powerSource = new ol.source.Vector({\n          features: features\n        });\n        var routeCoords = features;\n\n        if(type== 1) {\n          powerIconLayer.setSource(powerSource);\n        }else if(type == 2){\n          monitorIconLayer.setSource(powerSource)\n        }else if(type == 3){\n          siteIconLayer.setSource(powerSource)\n        }\n      }\n    }\n  });\n}\n\n//显示marker的内容\nvar displayFeatureInfo = function(pixel) {\n  var features = [];\n  map.forEachFeatureAtPixel(pixel, function(feature) {\n    features.push(feature);\n  });\n  // var lonlat = map.getLonLatFromPixel(pixel);\n  if (features.length > 0) {\n    var info = [];\n    var i, ii;\n    for (i = 0, ii = features.length; i < ii; ++i) {\n      info.push(features[i].get('name'));\n    }\n    // document.getElementById('info').innerHTML = info.join(', ') || '(unknown)';\n\n    var shownamePop =  '<div class=\"namepop\"></div>';\n      $('.namepop').html( '<a href=\"javascript\">'+features[i].get('name')+'</a>');\n       var shownamePop = new ol.Overlay(({\n        element: shownamePop,\n        autoPan: true,\n        offset:[-4,-4],\n        autoPanAnimation: {\n          duration: 250 //当Popup超出地图边界时，地图移动的速度\n        }\n      }));\n    shownamePop.setPosition(evt.coordinate)\n  } else {\n    // document.getElementById('info').innerHTML = '&nbsp;';\n  }\n};\n//###############################################################//\n//                  事件区域                                     //\n//###############################################################//\n//为map添加点击事件监听，弹出popup\nvar map_click = map.on('click', function(evt) {\n  //endCall(false);\n  $('.ol-overlaycontainer-stopevent .ol-popup-container').remove();\n  $('.commonlog-box').remove();\n  var pixel = map.getEventPixel(evt.originalEvent);\n  var feature = map.forEachFeatureAtPixel(pixel, function(feature) {\n    return feature;\n  }); //判断当前单击处是否有要素，捕获到要素时弹出popup\n  // console.log(feature.getKeys())\n\n  var coordinate = evt.coordinate;\n  console.log(feature,feature.get(\"gpsType\"))\n  if (feature !== undefined  ) {\n      var popup_element = document.createElement('div');\n      popup_element.className = 'ol-popup';\n      var closer = document.createElement('a');\n      closer.href = 'javascript:;';\n      closer.className = 'ol-popup-closer';\n      var title = document.createElement('div');\n      title.className = 'title';\n      var content = document.createElement('div');\n      content.className = 'popup-content';\n      $(popup_element).append(closer);\n      $(popup_element).append(title);\n      $(popup_element).append(content);\n      //var coordinates = feature.getGeometry().get(\"coordinates\");\n      //-----------------------------------------------------\n      var gpsType = feature.get(\"gpsType\");\n      if(gpsType ==2 && feature.get('url')!=\"\" && feature.get('url')!=undefined){//视频监控\n          popup_element.className = 'ol-popup ol-popup-monitor';\n          var info_popup = new ol.Overlay(({\n            element: popup_element,\n            autoPan: true,\n            offset:[-220,-445],\n            autoPanAnimation: {\n              duration: 250 //当Popup超出地图边界时，地图移动的速度\n            }\n          }));\n          map.addOverlay(info_popup);\n          title.innerHTML = '<div><strong>视频详情</strong></div></div>';\n          content.innerHTML ='<div class=\"down-arrow2\"></div><div class=\"cesium-infoBox-description\"><div id=\"myplayer\" style=\"width:480px; height:340px\"></div></div>';\n          info_popup.setPosition(coordinate);\n\n          var videoObject = {\n            container: '#myplayer',//“#”代表容器的ID，“.”或“”代表容器的class\n            variable: 'player',//该属性必需设置，值等于下面的new chplayer()的对象\n            flashplayer:false,//如果强制使用flashplayer则设置成true\n            video: feature.get('url'),//视频地址\n            autoplay:true\n          };\n          var player=new ckplayer(videoObject);\n\n          $(closer).on('click', function(event) {\n            event.preventDefault();\n            info_popup.setPosition(undefined);\n          }); // 点击关闭的按钮\n        }\n      else if(gpsType ==1 && feature.get('id')!= undefined  ){\n          //  popup_element.className = 'ol-popup ol-popup-station ol-popup-industry';\n          //   var info_popup = new ol.Overlay(({\n          //   element: popup_element,\n          //   autoPan: true,\n          //   offset:[-180,-152],\n          //   autoPanAnimation: {\n          //     duration: 250 //当Popup超出地图边界时，地图移动的速度\n          //   }\n          // }));\n          // map.addOverlay(info_popup);\n          // var name = feature.get(\"id\");\n          // var deviceinfoName = feature.get(\"deviceinfoName\");\n          // var monitorsiteName = feature.get(\"monitorsiteName\");\n\n          // title.innerHTML = '<div><strong>监测站点</strong></div></div>';\n          // content.innerHTML ='<div class=\"icon-drop2\"></div><div class=\"down-arrow2\"></div><div class=\"cesium-infoBox-description\"><table>'+\n          // '<tr><th width=150>检测器ID</th><td>'+name+\n          // '<tr><th width=150>检测器名称</th><td>'+deviceinfoName+\n          // '<tr><th width=150>所属监测站</th><td>'+monitorsiteName+\n          // '<tr><th width=150>经度</th><td>'+feature.get(\"longitude\")+\n          // '<tr><th width=150>纬度</th><td>'+feature.get(\"latitude\")+\n          // '</table></div>';\n          // info_popup.setPosition(coordinate);\n          // $(closer).on('click', function(event) {\n          //   event.preventDefault();\n          //   info_popup.setPosition(undefined);\n          // }); // 点击关闭的按钮\n          // $('.ol-popup-industry .icon-drop2').on('click',  function(){\n          //     $('.ol-popup-industry table tr').show();\n          //     if($(this).hasClass('icon-sq')) {\n          //       $('.ol-popup-industry table tr:gt(8)').hide()\n          //     }\n          //     $(this).toggleClass('icon-sq');\n          //     $('.down-arrow2').toggleClass('hide')\n          // })\n\n          var id = feature.get(\"id\");\n          var deviceinfoName = feature.get(\"deviceinfoName\");\n          var monitorsiteName = feature.get(\"monitorsiteName\");\n          var longitude   = feature.get(\"longitude\");\n          var latitude   = feature.get(\"latitude\");\n          var plusinfo = '';\n          plusinfo+='<tr><th width=150>检测器ID</th><td>'+id;\n          plusinfo+='<tr><th width=150>检测器名称</th><td>'+deviceinfoName;\n          plusinfo+='<tr><th width=150>所属监测站</th><td>'+monitorsiteName;\n          plusinfo+='<tr><th width=150>经度</th><td>'+longitude;\n          plusinfo+='<tr><th width=150>纬度</th><td>'+latitude;\n          plusinfo+='<tr><th width=150>下位机IP</th><td>'+feature.get(\"ipAddress\");\n          plusinfo+='<tr><th width=150>端口</th><td>'+feature.get(\"port\");\n          plusinfo+='<tr><th width=150>状态</th><td>'+feature.get(\"status\");\n          plusWidth=-63*8;\n          var plusinfo_suf=\"\";\n          buildPopUp(map,coordinate,popup_element,title,content,closer, '监测设备信息',plusinfo,plusinfo_suf,[-180,plusWidth]);\n       }\n       else if(gpsType == 99){\n          var plusinfo = \"\";\n          var plusWidth = 0;\n          var name = feature.get(\"name\");\n          var userName = feature.get(\"userName\");\n          var longitude   = feature.get(\"longitude\");\n          var latitude   = feature.get(\"latitude\");\n          var siteid = feature.get(\"id\");\n          plusinfo+='<tr><th width=150>监测站点名称</th><td>'+name+\"</td></tr>\";\n          plusinfo+='<tr><th width=150>负责人</th><td>'+userName+\"</td></tr>\";\n          plusinfo+='<tr><th width=150>经度</th><td>'+longitude+\"</td></tr>\";\n          plusinfo+='<tr><th width=150>纬度</th><td>'+latitude+\"</td></tr>\";\n          //plusinfo+='<tr><th width=75>指标</th><td>'+latitude;\n\n          plusWidth=-63*4;\n\n          var plusinfo_suf=\"\";\n          plusinfo_suf+='<span>指标</span>'\n          plusinfo_suf+='<select id=\"sel_factor\">'\n          //plusinfo_suf+='<option>Volvo</option>'\n          //plusinfo_suf+='<option selected=\"selected\">Saab</option>'\n          //plusinfo_suf+='<option>Mercedes</option>'\n          //plusinfo_suf+='<option>Audi</option>'\n          plusinfo_suf+='</select>';\n          plusinfo_suf+='   <button id=\"search\">&nbsp;查询&nbsp;</button>'\n          plusinfo_suf+='<br>';\n          //plusinfo_suf+='<span>起始</span><input name=\"start_time\" type=\"text\"    class=\"Wdate\" id=\"date1\" onfocus=\"WdatePicker({dateFmt: \\'yyyy/MM\\'})\">'\n          plusinfo_suf+='<span>起始</span><input name=\"start_time\" type=\"text\" class=\"Wdate\" id=\"beginDate\" onfocus=\"WdatePicker({dateFmt: \\'yyyy-MM\\',maxDate:\\'#F{$dp.$D(\\\\\\'endDate\\\\\\')||\\\\\\'%y-%M-%d\\\\\\'}\\' })\">'\n          plusinfo_suf+='<span>结束</span><input name=\"start_time\" type=\"text\" class=\"Wdate\" id=\"endDate\" onfocus=\"WdatePicker({dateFmt: \\'yyyy-MM\\',maxDate:\\'%y-%M-%d\\', minDate:\\'#F{$dp.$D(\\\\\\'beginDate\\\\\\')}\\' })\">';\n          plusinfo_suf+='<div id=\"chartDiv\" style=\"width: 400px;height:400px;\"></div>';\n          plusWidth=-63*5;\n          buildPopUp(map,coordinate,popup_element,title,content,closer, '监测站点',plusinfo,plusinfo_suf,[-180,plusWidth]);\n\n          $.get(xhost_getFactors,function(data){\n              console.log(data)\n              $(\"#sel_factor\").html(\"\");\n              for (var i = data.length - 1; i >= 0; i--) {\n                 $(\"#sel_factor\").append(\"<option value='\"+data[i].code+\"' >\"+data[i].name+\"</option>\");\n              }\n          });\n          //getChartData()\n          $(\"#search\").click(function(){\n              getChartData(\"&monitorSiteId=\"+siteid)\n          });\n\n       }\n      $('.ol-popup').parents('.ol-overlay-container').addClass('ol-popup-container');\n  }\n\n\n});\n\nfunction getChartData(plusData){\n  var fid = $(\"#sel_factor option:selected\").val();\n  var beginDate = $(\"#beginDate\").val()\n  var endDate = $(\"#endDate\").val()\n  console.log(fid,beginDate,endDate)\n            $.ajax({\n              url:xhost_getEchartDataOption3,\n              async:false,\n              data:\"type=line&dateType=month&factor=\"+fid+\"&beginDate=\"+beginDate+\"&endDate=\"+endDate+plusData,\n              dataType:\"json\",\n              success: function(jsondata) {\n                    var chartDivId =\"chartDiv\";\n                    var node= document.getElementById(chartDivId);\n                    var title = jsondata.title.text;\n                    //$(\"#\"+chartDivId+\"_title\").text(title+\" (\"+ jsondata.title.subtext+\")\");\n                    //console.log(title);\n                    jsondata.title.text = \"\";\n                    jsondata.title.subtext = \"\";\n                    var myChart = echarts.init(node , 'light');\n                    myChart.setOption(jsondata,true)\n\n              }\n            });\n}\n//\nfunction buildPopUp(map,coordinate,popup_element,title,content,closer,titleinfo,plusinfo,plusinfo_suf,offset){\n        popup_element.className = 'ol-popup ol-popup-station ol-popup-industry';\n            var info_popup = new ol.Overlay(({\n            element: popup_element,\n            autoPan: true,\n            offset:offset,\n            autoPanAnimation: {\n              duration: 250 //当Popup超出地图边界时，地图移动的速度\n            }\n          }));\n          map.addOverlay(info_popup);\n          // var name = feature.get(\"id\");\n          // var deviceinfoName = feature.get(\"deviceinfoName\");\n          // var monitorsiteName = feature.get(\"monitorsiteName\");\n          // var longitude   = feature.get(\"longitude\");\n          // var latitude   = feature.get(\"latitude\");\n\n          title.innerHTML = '<div><strong>'+titleinfo+'</strong></div></div>';\n          content.innerHTML ='<div class=\"icon-drop2\"></div><div class=\"down-arrow2\"></div><div class=\"cesium-infoBox-description\"><table>'+\n          // '<tr><th width=150>检测器ID</th><td>'+name+\n          // '<tr><th width=150>检测器名称</th><td>'+deviceinfoName+\n          // '<tr><th width=150>所属监测站</th><td>'+monitorsiteName+\n          // '<tr><th width=150>经度</th><td>'+longitude+\n          // '<tr><th width=150>纬度</th><td>'+latitude+\n          plusinfo+\n          '</table>'+plusinfo_suf+'</div>';\n\n          info_popup.setPosition(coordinate);\n          $(closer).on('click', function(event) {\n            event.preventDefault();\n            info_popup.setPosition(undefined);\n          }); // 点击关闭的按钮\n          $('.ol-popup-industry .icon-drop2').on('click',  function(){\n              $('.ol-popup-industry table tr').show();\n              if($(this).hasClass('icon-sq')) {\n                $('.ol-popup-industry table tr:gt(8)').hide()\n              }\n              $(this).toggleClass('icon-sq');\n              $('.down-arrow2').toggleClass('hide')\n          })\n}\n//\nmap.on('pointermove', function(evt) {\n  $('.ol-overlaycontainer-stopevent .ol-namepop-container').remove();\n  if (evt.dragging) {\n    return;\n  }\n  var pixel = map.getEventPixel(evt.originalEvent);\n  var features = [];\n  map.forEachFeatureAtPixel(pixel, function(feature) {\n    features.push(feature);\n  });\n\n  if (features.length > 0) {\n      var i, ii;\n      for (i = 0, ii = features.length; i < ii; ++i) {\n        var gpsType = features[i].get(\"gpsType\");\n\n        //if(features[i].get('deviceinfoName')!=undefined && features[i].get('monitorsiteName')!= undefined)\n        if(gpsType!= undefined)\n        {\n            var showname =features[i].get('deviceinfoName');\n            if(gpsType==99){\n              showname=features[i].get('name');\n            }\n            var shownamePopelement = document.createElement('div');\n                shownamePopelement.className = 'ol-namepop';\n                $('.ol-namepop').parents('.ol-overlay-container').addClass('ol-namepop-container')\n\n            $('.ol-namepop').html('<a href=\"javascript:;\">'+showname+'</a>');\n             var shownamePop = new ol.Overlay(({\n              element: shownamePopelement,\n              autoPan: true,\n              offset:[14,-4],\n              autoPanAnimation: {\n                duration: 250 //当Popup超出地图边界时，地图移动的速度\n              }\n            }));\n          map.addOverlay(shownamePop);\n          shownamePop.setPosition(evt.coordinate)\n        }\n      }\n  }\n\n});\n//###############################################################//\n//                  初始化区域                                   //\n//###############################################################//\n\n\n// 水电站 -添加marker点\ninitPowerIcon(xhost_getDevices,1);\nmap.addLayer(powerIconLayer);\npowerIconLayer.setZIndex(7);\n\n//监控探头\ninitPowerIcon(xhost_getMonitors, 2);\nmap.addLayer(monitorIconLayer);\nmonitorIconLayer.setZIndex(7);\n\ninitPowerIcon(xhost_getSites, 3);\nmap.addLayer(siteIconLayer);\nsiteIconLayer.setZIndex(7);\n// 三明区域线\n var vector1 = new ol.layer.Vector({\n      source: new ol.source.Vector({\n        url: '../resource/mapData/sanming1.kml',\n        // projection: prj.gps84_To_Gcj02('EPSG:4326', 'EPSG:3857'),\n        projection:'EPSG:3857',\n        format: new ol.format.KML({\n         // extractStyles: false,\n          // writeStyles:true,\n          defaultStyle:new  ol.style.Style({\n            stroke: new ol.style.Stroke({\n            // color: 'rgba(251, 177, 0, 1)',\n            width: 2\n           })\n          }),\n        }),\n      })\n    });\nmap.addLayer(vector1)\nvector1.setZIndex(6);\n\n//###############################################################//\n//                 页面事件(jquery)区域                          //\n//###############################################################//\n$('.js-togglewater').click(function(){\n    if($(this).hasClass('active')){\n        map.addLayer(powerIconLayer)\n        $(this).attr('title','点击隐藏水质监测仪器')\n    } else {\n        map.removeLayer(powerIconLayer)\n        $(this).attr('title','点击显示水质监测仪器')\n    }\n    $(this).toggleClass('active');\n})\n$('.js-togglestation').click(function(){\n    if($(this).hasClass('active')){\n        //$('.ol-overlaycontainer-stopevent .people-label').show()\n        map.addLayer(monitorIconLayer)\n        $(this).attr('title','点击隐藏视频监控')\n    } else {\n        //$('.ol-overlaycontainer-stopevent .people-label').hide()\n         map.removeLayer(monitorIconLayer)\n        $(this).attr('title','点击显示视频监控')\n    }\n    $(this).toggleClass('active');\n})\n\n\n\n// WEBPACK FOOTER //\n// ./app/main.js"],"sourceRoot":""}
!function(e){function t(o){if(a[o])return a[o].exports;var n=a[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var a={};t.m=e,t.c=a,t.d=function(e,a,o){t.o(e,a)||Object.defineProperty(e,a,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(a,"a",a),a},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,a){"use strict";a(1)},function(e,t,a){"use strict";function o(e,t){$.ajax({url:e,success:function(e){if(e.features){for(var a=0;a<e.features.length;a++)e.features[a].geometry.coordinates=gcj02towgs84(e.features[a].geometry.coordinates[0],e.features[a].geometry.coordinates[1]);var o=(new ol.format.GeoJSON).readFeatures(e,{featureProjection:"EPSG:3857"}),n=new ol.source.Vector({features:o});1==t?l.setSource(n):2==t?c.setSource(n):3==t&&d.setSource(n)}}})}function n(e){var t=$("#sel_factor option:selected").val(),a=$("#beginDate").val(),o=$("#endDate").val();console.log(t,a,o),$.ajax({url:s,async:!1,data:"type=line&dateType=month&factor="+t+"&beginDate="+a+"&endDate="+o+e,dataType:"json",success:function(e){var t=document.getElementById("chartDiv");e.title.text;e.title.text="",e.title.subtext="",echarts.init(t,"light").setOption(e,!0)}})}function i(e,t,a,o,n,i,r,s,l,c){a.className="ol-popup ol-popup-station ol-popup-industry";var d=new ol.Overlay({element:a,autoPan:!0,offset:c,autoPanAnimation:{duration:250}});e.addOverlay(d),o.innerHTML="<div><strong>"+r+"</strong></div></div>",n.innerHTML='<div class="icon-drop2"></div><div class="down-arrow2"></div><div class="cesium-infoBox-description"><table>'+s+"</table>"+l+"</div>",d.setPosition(t),$(i).on("click",function(e){e.preventDefault(),d.setPosition(void 0)}),$(".ol-popup-industry .icon-drop2").on("click",function(){$(".ol-popup-industry table tr").show(),$(this).hasClass("icon-sq")&&$(".ol-popup-industry table tr:gt(8)").hide(),$(this).toggleClass("icon-sq"),$(".down-arrow2").toggleClass("hide")})}var r="http://127.0.0.1:8088/",s=r+"api/getEchartDataOption3",l=new ol.layer.Vector({style:function(e,t){var a=(e.getGeometry(),e.getGeometry().getCoordinates()),o="../images/sdz.png";e.get("equipName")&&(o="../images/industry.png");var n=new ol.style.Style({image:new ol.style.Icon({opacity:1,scale:1,src:o}),geometry:new ol.geom.Point(a)});e.setStyle(n);var i=document.createElement("div");i.className="label cityLabel",i.innerHTML='<span class="donenum">'+e.get("deviceinfoName")+"</span>",new ol.Overlay({element:i,offset:[-3,-42],stopEvent:!1}).setPosition(a)}}),c=new ol.layer.Vector({style:function(e,t){var a=(e.getGeometry(),e.getGeometry().getCoordinates()),o=new ol.style.Style({image:new ol.style.Icon({opacity:1,scale:1,src:"../images/monitor.png"}),geometry:new ol.geom.Point(a)});e.setStyle(o)}}),d=new ol.layer.Vector({style:function(e,t){var a=(e.getGeometry(),e.getGeometry().getCoordinates()),o="../images/company.png";0==e.get("parentId")&&(o="../images/ent.png");var n=new ol.style.Style({image:new ol.style.Icon({opacity:1,scale:1,src:o}),geometry:new ol.geom.Point(a)});e.setStyle(n)}});map.on("click",function(e){$(".ol-overlaycontainer-stopevent .ol-popup-container").remove(),$(".commonlog-box").remove();var t=map.getEventPixel(e.originalEvent),a=map.forEachFeatureAtPixel(t,function(e){return e}),o=e.coordinate;if(console.log(a,a.get("gpsType")),void 0!==a){var r=document.createElement("div");r.className="ol-popup";var s=document.createElement("a");s.href="javascript:;",s.className="ol-popup-closer";var l=document.createElement("div");l.className="title";var c=document.createElement("div");c.className="popup-content",$(r).append(s),$(r).append(l),$(r).append(c);var d=a.get("gpsType");if(2==d&&""!=a.get("url")&&void 0!=a.get("url")){r.className="ol-popup ol-popup-monitor";var p=new ol.Overlay({element:r,autoPan:!0,offset:[-220,-445],autoPanAnimation:{duration:250}});map.addOverlay(p),l.innerHTML="<div><strong>视频详情</strong></div></div>",c.innerHTML='<div class="down-arrow2"></div><div class="cesium-infoBox-description"><div id="myplayer" style="width:480px; height:340px"></div></div>',p.setPosition(o);var u={container:"#myplayer",variable:"player",flashplayer:!1,video:a.get("url"),autoplay:!0};new ckplayer(u);$(s).on("click",function(e){e.preventDefault(),p.setPosition(void 0)})}else if(1==d&&void 0!=a.get("id")){var m=a.get("id"),g=a.get("deviceinfoName"),v=a.get("monitorsiteName"),y=a.get("longitude"),h=a.get("latitude"),f="";f+="<tr><th width=150>检测器ID</th><td>"+m,f+="<tr><th width=150>检测器名称</th><td>"+g,f+="<tr><th width=150>所属监测站</th><td>"+v,f+="<tr><th width=150>经度</th><td>"+y,f+="<tr><th width=150>纬度</th><td>"+h,f+="<tr><th width=150>下位机IP</th><td>"+a.get("ipAddress"),f+="<tr><th width=150>端口</th><td>"+a.get("port"),f+="<tr><th width=150>状态</th><td>"+a.get("status"),x=-504;var w="";i(map,o,r,l,c,s,"监测设备信息",f,w,[-180,x])}else if(99==d){var f="",x=0,P=a.get("name"),b=a.get("userName"),y=a.get("longitude"),h=a.get("latitude"),D=a.get("id");f+="<tr><th width=150>监测站点名称</th><td>"+P+"</td></tr>",f+="<tr><th width=150>负责人</th><td>"+b+"</td></tr>",f+="<tr><th width=150>经度</th><td>"+y+"</td></tr>",f+="<tr><th width=150>纬度</th><td>"+h+"</td></tr>",x=-252;var w="";w+="<span>指标</span>",w+='<select id="sel_factor">',w+="</select>",w+='   <button id="search">&nbsp;查询&nbsp;</button>',w+="<br>",w+='<span>起始</span><input name="start_time" type="text" class="Wdate" id="beginDate" onfocus="WdatePicker({dateFmt: \'yyyy-MM\',maxDate:\'#F{$dp.$D(\\\'endDate\\\')||\\\'%y-%M-%d\\\'}\' })">',w+='<span>结束</span><input name="start_time" type="text" class="Wdate" id="endDate" onfocus="WdatePicker({dateFmt: \'yyyy-MM\',maxDate:\'%y-%M-%d\', minDate:\'#F{$dp.$D(\\\'beginDate\\\')}\' })">',w+='<div id="chartDiv" style="width: 400px;height:400px;"></div>',x=-315,i(map,o,r,l,c,s,"监测站点",f,w,[-180,x]),$.get("http://127.0.0.1:8088/api/getFactors",function(e){console.log(e),$("#sel_factor").html("");for(var t=e.length-1;t>=0;t--)$("#sel_factor").append("<option value='"+e[t].code+"' >"+e[t].name+"</option>")}),$("#search").click(function(){n("&monitorSiteId="+D)})}$(".ol-popup").parents(".ol-overlay-container").addClass("ol-popup-container")}});map.on("pointermove",function(e){if($(".ol-overlaycontainer-stopevent .ol-namepop-container").remove(),!e.dragging){var t=map.getEventPixel(e.originalEvent),a=[];if(map.forEachFeatureAtPixel(t,function(e){a.push(e)}),a.length>0){var o,n;for(o=0,n=a.length;o<n;++o){var i=a[o].get("gpsType");if(void 0!=i){var r=a[o].get("deviceinfoName");99==i&&(r=a[o].get("name"));var s=document.createElement("div");s.className="ol-namepop",$(".ol-namepop").parents(".ol-overlay-container").addClass("ol-namepop-container"),$(".ol-namepop").html('<a href="javascript:;">'+r+"</a>");var l=new ol.Overlay({element:s,autoPan:!0,offset:[14,-4],autoPanAnimation:{duration:250}});map.addOverlay(l),l.setPosition(e.coordinate)}}}}}),o("http://127.0.0.1:8088/api/gps/getDevices?type=1",1),map.addLayer(l),l.setZIndex(7),o("http://127.0.0.1:8088/api/gps/getDevices?type=2",2),map.addLayer(c),c.setZIndex(7),o("http://127.0.0.1:8088/api/gps/getSites",3),map.addLayer(d),d.setZIndex(7);var p=new ol.layer.Vector({source:new ol.source.Vector({url:"../resource/mapData/sanming1.kml",projection:"EPSG:3857",format:new ol.format.KML({defaultStyle:new ol.style.Style({stroke:new ol.style.Stroke({width:2})})})})});map.addLayer(p),p.setZIndex(6),$(".js-togglewater").click(function(){$(this).hasClass("active")?(map.addLayer(l),$(this).attr("title","点击隐藏水质监测仪器")):(map.removeLayer(l),$(this).attr("title","点击显示水质监测仪器")),$(this).toggleClass("active")}),$(".js-togglestation").click(function(){$(this).hasClass("active")?(map.addLayer(c),$(this).attr("title","点击隐藏视频监控")):(map.removeLayer(c),$(this).attr("title","点击显示视频监控")),$(this).toggleClass("active")})}]);
//# sourceMappingURL=bundle.js.map